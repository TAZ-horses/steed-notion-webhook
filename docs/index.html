function toggleAllPasswords() {
  allPasswordsVisible = !allPasswordsVisible;
  // Update existing password fields
  document.querySelectorAll(".password-field").forEach(span => {
    span.textContent = allPasswordsVisible ? span.dataset.pass : "â€¢â€¢â€¢â€¢â€¢â€¢";
  });
  
  // Update the toggle button text
  const toggleBtn = document.querySelector("#toolbar button:first-child");
  toggleBtn.textContent = allPasswordsVisible ? "ðŸ”’ Toggle Passwords" : "ðŸ”“ Toggle Passwords";
}

// Modify the node click handler to properly handle password fields
node.on("click", (event, d) => {
  if (d.data.username || d.data.password || d.data.notes) {
    const passwordContent = d.data.password 
      ? `<b>Pass:</b> <span class="password-field" data-pass="${d.data.password}">
          ${allPasswordsVisible ? d.data.password : "â€¢â€¢â€¢â€¢â€¢â€¢"}
         </span> 
         <button class="copy-btn" data-pass="${d.data.password}">ðŸ“‹</button><br>`
      : "";
    
    tooltip.style("display", "block")
      .html(`
        <strong>${d.data.name}</strong><br>
        ${d.data.username ? `<b>User:</b> ${d.data.username}<br>` : ""}
        ${passwordContent}
        ${d.data.notes ? `<b>Notes:</b> ${d.data.notes}` : ""}
      `)
      .style("left", (event.pageX + 10) + "px")
      .style("top", (event.pageY - 20) + "px");
    
    // Add click handler for the copy button
    tooltip.select(".copy-btn").on("click", function() {
      navigator.clipboard.writeText(this.dataset.pass);
      this.textContent = "âœ“";
      setTimeout(() => this.textContent = "ðŸ“‹", 1000);
    });
  }
});
